@let _narrowScreen = vpWidth() < 720;
<div>
  @let _user = auth.user();
  <header class="absolute top-0 left-0 right-0 h-16">
    <app-mainbar [togglableView]="!_narrowScreen" />
  </header>
  <main [class]="`absolute top-16 left-0 right-0 bottom-0 overflow-auto`">
    @if (navigation.isInitial()) {
    <app-navigator />
    } @else if (_user) {
    <ng-container
      [ngTemplateOutlet]="_narrowScreen || singularView.enabled() ? _singularView : _compoundView"
    />
    } @else {
    <ng-container [ngTemplateOutlet]="_mainContent" />
    }
  </main>
</div>

<p-toast position="bottom-right" />

<ng-template #_singularView>
  <ng-container [ngTemplateOutlet]="mainMenuRouteActivated() ? _mainMenu : _mainContent" />
</ng-template>

<ng-template #_compoundView>
  <div class="absolute top-0 left-0 w-82 h-full overflow-auto border-surface border-r">
    <ng-container [ngTemplateOutlet]="_mainMenu" />
  </div>
  <div class="absolute top-0 left-82 right-0 h-full overflow-auto">
    <ng-container [ngTemplateOutlet]="_mainContent" />
  </div>
</ng-template>

<ng-template #_mainMenu>
  <nav class="absolute size-full overflow-auto">
    <p-tabs [value]="activeMenuIndex()">
      <p-tablist [pt]="{ content: { class: `*:h-10 *:border-0` } }">
        @for(_navItem of mainNavItems; track _navItem){
        <p-tab [value]="$index" class="inline-block relative w-1/2 h-full p-0">
          <a
            ariaCurrentWhenActive="page"
            routerLinkActive="p-tab-active"
            [routerLink]="[_navItem.route]"
            [routerLinkActiveOptions]="{ exact: true }"
            class="inline-block relative size-full text-center leading-tight *:align-middle"
          >
            <span class="absolute top-1/2 left-1/2 -translate-1/2">
              <i [class]="_navItem.icon"></i>&nbsp;{{ _navItem.label }}
            </span>
          </a>
        </p-tab>
        }
      </p-tablist>
    </p-tabs>
    <div [class]="`absolute top-10 left-0 bottom-0 w-full overflow-auto`">
      <router-outlet name="mainMenu" />
    </div>
  </nav>
</ng-template>

<ng-template #_mainContent>
  @if (navigation.navigating() || navigation.error()) {
  <app-navigator />
  } @else {
  <router-outlet />
  }
</ng-template>

<!-- prettier-ignore -->
@let _user = auth.user();
@let _narrowScreen = vpWidth() < 720;
@let _singularViewEnabled = singularViewEnabled();
<div>
  <header
    [class]="`absolute top-0 left-0 right-0 h-16 overflow-auto bg-primary
      flex flex-wrap justify-center items-center border-surface border-b px-2
    `"
  >
    <h1 class="text-primary-contrast text-2xl text-center font-bold p-2">{{ title }}</h1>
    <div class="ms-auto space-x-2 *:text-xs">
      <!-- prettier-ignore -->
      @let _scheme = colorScheme.scheme();
      @let _SchemeTitle= `${_scheme.value[0].toUpperCase()}${_scheme.value.slice(1)}`;
      <button
        pButton
        pRipple
        rounded
        size="small"
        type="button"
        [icon]="_scheme.icon"
        (click)="colorScheme.switch()"
        aria-label="Switch color scheme. {{ _SchemeTitle }} selected."
      ></button>
      @if (_user) {
      <!-- prettier-ignore -->
      @if(!_narrowScreen) {
      <!-- prettier-ignore -->
      @let _mainMenuTogglerLabel = _singularViewEnabled  ? 'Open main menu' : 'Close main menu';
      <button
        pButton
        pRipple
        rounded
        size="small"
        type="button"
        (click)="toggleSingularView()"
        aria-label="{{ _mainMenuTogglerLabel }}"
        icon="{{ _singularViewEnabled ? 'pi pi-tablet' : 'pi pi-th-large' }}"
      ></button>
      }
      <button
        pButton
        pRipple
        rounded
        size="small"
        type="button"
        icon="pi pi-sign-out"
        aria-label="Sign Out"
        (click)="signOut()"
      ></button>
      }
    </div>
  </header>
  <div [class]="`absolute top-16 left-0 right-0 bottom-0 overflow-auto`">
    @if (navigating() || navErrMsg()) {
    <main class="absolute top-1/2 left-1/2 -translate-1/2 z-50">
      @if (navErrMsg(); as _navErrMsg) {
      <app-error-message [message]="_navErrMsg" (retry)="retryNavigation()" />
      } @else {
      <app-spinner ariaLabel="Loading..." />
      }
    </main>
    } @else if (_user) {
    <!-- prettier-ignore -->
    @if(_narrowScreen || _singularViewEnabled) {
    <ng-container [ngTemplateOutlet]="_singularView" />
    } @else {
    <ng-container [ngTemplateOutlet]="_compoundView" />
    }
    <!-- prettier-ignore -->
    } @else {
    <main>
      <router-outlet />
    </main>
    }
  </div>
</div>

<ng-template #_singularView>
  @if (navListRouteActivated()) {
  <ng-container [ngTemplateOutlet]="_nav" />
  } @else {
  <main>
    <router-outlet />
  </main>
  }
</ng-template>

<ng-template #_compoundView>
  <div class="absolute top-0 left-0 w-82 h-full border-surface border-r overflow-auto">
    <ng-container [ngTemplateOutlet]="_nav" />
  </div>
  <main class="absolute top-0 left-82 right-0 h-full overflow-auto">
    <router-outlet />
  </main>
</ng-template>

<ng-template #_nav>
  <nav class="absolute size-full overflow-auto">
    <p-tabs [value]="activeNavItemIndex()">
      <p-tablist [pt]="{ content: { class: `*:h-10 *:border-0` } }">
        @for(_navItem of navItems; track _navItem){
        <p-tab [value]="$index" class="inline-block relative w-1/2 h-full p-0">
          <a
            ariaCurrentWhenActive="page"
            routerLinkActive="p-tab-active"
            [routerLink]="[_navItem.route]"
            [routerLinkActiveOptions]="{ exact: true }"
            class="inline-block relative size-full text-center leading-tight *:align-middle"
          >
            <span class="absolute top-1/2 left-1/2 -translate-1/2">
              <i [class]="_navItem.icon"></i>&nbsp;{{ _navItem.label }}
            </span>
          </a>
        </p-tab>
        }
      </p-tablist>
    </p-tabs>
    <div [class]="`absolute top-10 left-0 bottom-0 w-full overflow-auto`">
      <router-outlet name="nav" />
    </div>
  </nav>
</ng-template>

<p-toast position="bottom-right" />

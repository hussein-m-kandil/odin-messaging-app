<div class="h-screen flex flex-col">
  @let _user=auth.user();
  @let _narrowScreen = vpWidth() < 720; <!-- -->
    <header>
      <app-mainbar [togglableView]="!_narrowScreen" />
    </header>
    <main class="grow overflow-auto">
      @if (navigation.isInitial()) {
      <app-navigator />
      } @else if (_user) {
      <ng-container
                    [ngTemplateOutlet]="_narrowScreen || singularView.enabled() ? _singularView : _compoundView" />
      } @else {
      <ng-container [ngTemplateOutlet]="_mainContent" />
      }
    </main>
</div>

<p-toast position="bottom-right" class="w-[calc(100%-40px)] max-w-md" />

<ng-template #_singularView>
  <ng-container [ngTemplateOutlet]="mainMenuRouteActivated() ? _mainMenu : _mainContent" />
</ng-template>

<ng-template #_compoundView>
  @if (notFoundRouteActivated()) {
  <ng-container [ngTemplateOutlet]="_mainContent" />
  } @else {
  <p-splitter [panelSizes]="[35, 65]" [minSizes]="[25, 25]" [gutterSize]="1"
              class="size-full overflow-auto *:h-full *:overflow-auto">
    <ng-template #panel>
      <ng-container [ngTemplateOutlet]="_mainMenu" />
    </ng-template>
    <ng-template #panel>
      <ng-container [ngTemplateOutlet]="_mainContent" />
    </ng-template>
  </p-splitter>
  }
</ng-template>

<ng-template #_mainMenu>
  <nav class="size-full flex flex-col">
    <p-tabs [value]="activeMenuIndex()">
      <p-tablist>
        @for(_navItem of mainNavItems; track _navItem.route){
        <p-tab [value]="$index" class="grow p-0">
          <a ariaCurrentWhenActive="page" routerLinkActive="p-tab-active"
             [routerLink]="[_navItem.route]" [routerLinkActiveOptions]="{ exact: true }"
             class="inline-block w-full p-1.5 text-center leading-tight *:align-middle">
            <i [class]="_navItem.icon"></i>&nbsp;{{ _navItem.label }}
          </a>
        </p-tab>
        }
      </p-tablist>
    </p-tabs>
    <div class="grow overflow-auto">
      <router-outlet name="mainMenu" />
    </div>
  </nav>
</ng-template>

<ng-template #_mainContent>
  @if (navigation.navigating() || navigation.error()) {
  <app-navigator />
  } @else {
  <router-outlet />
  }
</ng-template>
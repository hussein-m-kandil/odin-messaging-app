<div class="relative size-full overflow-auto" (scroll)="flushLoadMoreBtnWhenVisible()">
  @if (profiles.loading()) {
  <app-spinner ariaLabel="Loading profiles..." />
  } @else if (profiles.loadError(); as _loadError) {
  <app-error-message [message]="_loadError" (retry)="profiles.load()" />
  } @else {
  <!-- prettier-ignore -->
  @let _profileList = profiles.list();
  @if (_profileList.length > 0) {
  <p-menu
    [model]="_profileList"
    ariaLabel="Profile list"
    styleClass="rounded-none border-none"
    [pt]="{ list: { class: 'gap-0' } }"
  >
    <ng-template #item let-_profile>
      <a
        pRipple
        ariaCurrentWhenActive="page"
        routerLinkActive="bg-highlight"
        [title]="_profile.user.username"
        [routerLink]="['/profiles', _profile.id]"
        [routerLinkActiveOptions]="{ exact: true }"
        class="size-full p-4 border-surface border-b flex items-center"
      >
        <p-avatar
          label="{{ _profile.user.username[0].toUpperCase() }}"
          class="shrink-0 me-2 text-center"
          shape="circle"
          size="normal"
        />
        <span class="font-semibold tracking-wider truncate">
          {{ _profile.user.username || 'Anonymous' }}
        </span>
      </a>
    </ng-template>
    <ng-template #end>
      @if(profiles.canLoadMore()) { @if(profiles.loadingMore()) {
      <app-spinner ariaLabel="Loading more profiles..." />
      } @else if (profiles.loadMoreError(); as _loadMoreError) {
      <app-error-message [message]="_loadMoreError" (retry)="profiles.loadMore()" />
      } @else {
      <div class="text-center">
        <button text outlined pButton #loadMoreBtn type="button" (click)="profiles.loadMore()">
          Load more
        </button>
      </div>
      } }
    </ng-template>
  </p-menu>
  } @else {
  <p class="text-muted-color">There are no profiles.</p>
  } }
</div>
